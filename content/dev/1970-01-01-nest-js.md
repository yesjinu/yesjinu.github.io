---
title: MySQL
slug: nest-js
date_published: 1970-01-01T00:00:00.000Z
date_updated: 2021-11-30T15:00:42.000Z
draft: true
---

## 문제 발생

- Platform 팀은 Jest를 이용해 테스트 코드를 작성하고 있다.
- DB에 저장된 게임 메타 정보를 update하는 함수에 대한 테스트를 작성하던 중이었다.
- 저장된 레코드의 일부 필드를 update하는 테스트 케이스를 작성하고, 명시적으로 변경한 필드에 대해서만 값이 변하고 이외의 필드는 값이 변하지 않았는지 확인해야 했다.
- 그런데 Date 부분에서 예상과 다른 결과가 발견됐다.

![](__GHOST_URL__/content/images/2021/11/image--34-.png)
- Update하지 않았던 `created_at` 필드가 변경되어 있던 것. 도대체 어떻게 된 일일까?

## 원인 추적

- 위 그림에서 `Expected value`는 JS object에서 `new Date()`로 생성한 값, `Received value` 는 DB에서 받아온 값이었다.

## 문제 해결

- TypeORM `save`는 '**DB에 저장된 값을 받아오는 것'**이 아닌, '**save에 인자로 넘긴 값**'을 그대로 리턴함. 따라서 소수점 이하 반올림 안 되어있음!!
- MySQL 테이블 생성 시 created_at의 칼럼 타입을 **초까지 저장하는****타입**으로 지정해놓았기 때문. 칼럼 타입으로 `Date`의 millisecond 까지 저장할 수 있도록 설정할 수도 있음 ([링크](https://stackoverflow.com/questions/13344994/mysql-5-6-datetime-doesnt-accept-milliseconds-microseconds))
